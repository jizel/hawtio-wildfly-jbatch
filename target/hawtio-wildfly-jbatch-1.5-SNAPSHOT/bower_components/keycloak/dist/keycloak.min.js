(function(a,c){var b=function(v){if(!(this instanceof b)){return new b(v)}var g=this;var l;var q=[];var r={enable:true,callbackMap:[],interval:5};g.init=function(z){g.authenticated=false;if(a.Cordova){l=t("cordova")}else{l=t()}if(z){if(typeof z.checkLoginIframe!=="undefined"){r.enable=z.checkLoginIframe}if(z.checkLoginIframeInterval){r.interval=z.checkLoginIframeInterval}if(z.onLoad==="login-required"){g.loginRequired=true}}var A=d();var x=d();x.promise.success(function(){g.onReady&&g.onReady(g.authenticated);A.setSuccess(g.authenticated)}).error(function(){A.setError()});var y=h(v);function w(){var D=f(a.location.href);if(D){a.history.replaceState({},null,D.newUrl);j(D,x);return}else{if(z){var C=function(E){if(!E){B.prompt="none"}g.login(B).success(function(){x.setSuccess()}).error(function(){x.setError()})};if(z.token||z.refreshToken){p(z.token,z.refreshToken,z.idToken);x.setSuccess()}else{if(z.onLoad){var B={};switch(z.onLoad){case"check-sso":if(r.enable){u().success(function(){i().success(function(){C(false)}).error(function(){x.setSuccess()})})}else{C(false)}break;case"login-required":C(true);break;default:throw"Invalid value for onLoad"}}}}else{x.setSuccess()}}}y.success(w);y.error(function(){A.setError()});return A.promise};g.login=function(w){return l.login(w)};g.createLoginUrl=function(x){var y=e();var z=l.redirectUri(x);if(x&&x.prompt){z+=(z.indexOf("?")==-1?"?":"&")+"prompt="+x.prompt}sessionStorage.oauthState=JSON.stringify({state:y,redirectUri:encodeURIComponent(z)});var w=k()+"/tokens/login?client_id="+encodeURIComponent(g.clientId)+"&redirect_uri="+encodeURIComponent(z)+"&state="+encodeURIComponent(y)+"&response_type=code";if(x&&x.prompt){w+="&prompt="+x.prompt}if(x&&x.loginHint){w+="&login_hint="+x.loginHint}return w};g.logout=function(w){return l.logout(w)};g.createLogoutUrl=function(x){var w=k()+"/tokens/logout?redirect_uri="+encodeURIComponent(l.redirectUri(x));return w};g.createAccountUrl=function(x){var w=k()+"/account?referrer="+encodeURIComponent(g.clientId)+"&referrer_uri="+encodeURIComponent(l.redirectUri(x));return w};g.accountManagement=function(){return l.accountManagement()};g.hasRealmRole=function(x){var w=g.realmAccess;return !!w&&w.roles.indexOf(x)>=0};g.hasResourceRole=function(y,x){if(!g.resourceAccess){return false}var w=g.resourceAccess[x||g.clientId];return !!w&&w.roles.indexOf(y)>=0};g.loadUserProfile=function(){var w=k()+"/account";var x=new XMLHttpRequest();x.open("GET",w,true);x.setRequestHeader("Accept","application/json");x.setRequestHeader("Authorization","bearer "+g.token);var y=d();x.onreadystatechange=function(){if(x.readyState==4){if(x.status==200){g.profile=JSON.parse(x.responseText);y.setSuccess(g.profile)}else{y.setError()}}};x.send();return y.promise};g.isTokenExpired=function(w){if(!g.tokenParsed||!g.refreshToken){throw"Not authenticated"}var x=g.tokenParsed.exp-(new Date().getTime()/1000);if(w){x-=w}return x<0};g.updateToken=function(w){var z=d();if(!g.tokenParsed||!g.refreshToken){z.setError();return z.promise}w=w||5;var x=function(){if(!g.isTokenExpired(w)){z.setSuccess(false)}else{var C="grant_type=refresh_token&refresh_token="+g.refreshToken;var A=k()+"/tokens/refresh";q.push(z);if(q.length==1){var B=new XMLHttpRequest();B.open("POST",A,true);B.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(g.clientId&&g.clientSecret){B.setRequestHeader("Authorization","Basic "+btoa(g.clientId+":"+g.clientSecret))}else{C+="&client_id="+encodeURIComponent(g.clientId)}B.onreadystatechange=function(){if(B.readyState==4){if(B.status==200){var E=JSON.parse(B.responseText);p(E.access_token,E.refresh_token,E.id_token);g.onAuthRefreshSuccess&&g.onAuthRefreshSuccess();for(var D=q.pop();D!=null;D=q.pop()){D.setSuccess(true)}}else{g.onAuthRefreshError&&g.onAuthRefreshError();for(var D=q.pop();D!=null;D=q.pop()){D.setError(true)}}}};B.send(C)}}};if(r.enable){var y=i();y.success(function(){x()}).error(function(){z.setError()})}else{x()}return z.promise};function k(){return g.authServerUrl+"/realms/"+encodeURIComponent(g.realm)}function s(){if(!a.location.origin){return a.location.protocol+"//"+a.location.hostname+(a.location.port?":"+a.location.port:"")}else{return a.location.origin}}function j(x,D){var B=x.code;var z=x.error;var w=x.prompt;if(B){var C="code="+B;var y=k()+"/tokens/access/codes";var A=new XMLHttpRequest();A.open("POST",y,true);A.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(g.clientId&&g.clientSecret){A.setRequestHeader("Authorization","Basic "+btoa(g.clientId+":"+g.clientSecret))}else{C+="&client_id="+encodeURIComponent(g.clientId)}C+="&redirect_uri="+x.redirectUri;A.withCredentials=true;A.onreadystatechange=function(){if(A.readyState==4){if(A.status==200){var E=JSON.parse(A.responseText);p(E.access_token,E.refresh_token,E.id_token);g.onAuthSuccess&&g.onAuthSuccess();D&&D.setSuccess()}else{g.onAuthError&&g.onAuthError();D&&D.setError()}}};A.send(C)}else{if(z){if(w!="none"){g.onAuthError&&g.onAuthError();D&&D.setError()}else{D&&D.setSuccess()}}}}function h(y){var B=d();var x;if(!v){x="keycloak.json"}else{if(typeof v==="string"){x=v}}if(x){var A=new XMLHttpRequest();A.open("GET",x,true);A.setRequestHeader("Accept","application/json");A.onreadystatechange=function(){if(A.readyState==4){if(A.status==200){var C=JSON.parse(A.responseText);g.authServerUrl=C["auth-server-url"];g.realm=C.realm;g.clientId=C.resource;g.clientSecret=(C.credentials||{})["secret"];B.setSuccess()}else{B.setError()}}};A.send()}else{if(!v.url){var w=document.getElementsByTagName("script");for(var z=0;z<w.length;z++){if(w[z].src.match(/.*keycloak\.js/)){v.url=w[z].src.substr(0,w[z].src.indexOf("/js/keycloak.js"));break}}}if(!v.realm){throw"realm missing"}if(!v.clientId){throw"clientId missing"}g.authServerUrl=v.url;g.realm=v.realm;g.clientId=v.clientId;g.clientSecret=(v.credentials||{}).secret;B.setSuccess()}return B.promise}function o(){if(g.token){p(null,null,null);g.onAuthLogout&&g.onAuthLogout();if(g.loginRequired){g.login()}}}function p(x,w,z){if(x||w){u()}if(x){g.token=x;g.tokenParsed=m(x);var y=g.realm+"/"+g.tokenParsed.sub;if(g.tokenParsed.session_state){y=y+"/"+g.tokenParsed.session_state}g.sessionId=y;g.authenticated=true;g.subject=g.tokenParsed.sub;g.realmAccess=g.tokenParsed.realm_access;g.resourceAccess=g.tokenParsed.resource_access}else{delete g.token;delete g.tokenParsed;delete g.subject;delete g.realmAccess;delete g.resourceAccess;g.authenticated=false}if(w){g.refreshToken=w;g.refreshTokenParsed=m(w)}else{delete g.refreshToken;delete g.refreshTokenParsed}if(z){g.idToken=z;g.idTokenParsed=m(z)}else{delete g.idToken;delete g.idTokenParsed}}function m(w){w=w.split(".")[1];w=w.replace("/-/g","+");w=w.replace("/_/g","/");switch(w.length%4){case 0:break;case 2:w+="==";break;case 3:w+="=";break;default:throw"Invalid token"}w=(w+"===").slice(0,w.length+(w.length%4));w=w.replace(/-/g,"+").replace(/_/g,"/");w=decodeURIComponent(escape(atob(w)));w=JSON.parse(w);return w}function e(){var z=[];var w="0123456789abcdef";for(var x=0;x<36;x++){z[x]=w.substr(Math.floor(Math.random()*16),1)}z[14]="4";z[19]=w.substr((z[19]&3)|8,1);z[8]=z[13]=z[18]=z[23]="-";var y=z.join("");return y}g.callback_id=0;function n(){var w="<id: "+(g.callback_id++)+(Math.random())+">";return w}function f(y){if(y.indexOf("?")!=-1){var w={};w.newUrl=y.split("?")[0];var B=y.split("?")[1].split("&");for(var z=0;z<B.length;z++){var A=B[z].split("=");switch(decodeURIComponent(A[0])){case"code":w.code=A[1];break;case"error":w.error=A[1];break;case"state":w.state=decodeURIComponent(A[1]);break;case"redirect_fragment":w.fragment=decodeURIComponent(A[1]);break;case"prompt":w.prompt=A[1];break;default:w.newUrl+=(w.newUrl.indexOf("?")==-1?"?":"&")+A[0]+"="+A[1];break}}var x=sessionStorage.oauthState&&JSON.parse(sessionStorage.oauthState);if(x&&(w.code||w.error)&&w.state&&w.state==x.state){delete sessionStorage.oauthState;w.redirectUri=x.redirectUri;if(w.fragment){w.newUrl+="#"+w.fragment}return w}}}function d(){var w={setSuccess:function(x){w.success=true;w.result=x;if(w.successCallback){w.successCallback(x)}},setError:function(x){w.error=true;w.result=x;if(w.errorCallback){w.errorCallback(x)}},promise:{success:function(x){if(w.success){x(w.result)}else{if(!w.error){w.successCallback=x}}return w.promise},error:function(x){if(w.error){x(w.result)}else{if(!w.success){w.errorCallback=x}}return w.promise}}};return w}function u(){var A=d();if(!r.enable){return}if(r.iframe){A.setSuccess();return}var y=document.createElement("iframe");y.onload=function(){var B=k();if(B.charAt(0)==="/"){r.iframeOrigin=s()}else{r.iframeOrigin=B.substring(0,B.indexOf("/",8))}r.iframe=y;A.setSuccess()};var z=k()+"/protocol/openid-connect/login-status-iframe.html?client_id="+encodeURIComponent(g.clientId)+"&origin="+s();y.setAttribute("src",z);y.style.display="none";document.body.appendChild(y);var x=function(B){if(B.origin!==r.iframeOrigin){return}var C=JSON.parse(B.data);var D=r.callbackMap[C.callbackId];delete r.callbackMap[C.callbackId];if((!g.sessionId||g.sessionId==C.session)&&C.loggedIn){D.setSuccess()}else{o();D.setError()}};a.addEventListener("message",x,false);var w=function(){i();if(g.token){setTimeout(w,r.interval*1000)}};setTimeout(w,r.interval*1000);return A.promise}function i(){var y=d();if(r.iframe&&r.iframeOrigin){var x={};x.callbackId=n();r.callbackMap[x.callbackId]=y;var w=r.iframeOrigin;r.iframe.contentWindow.postMessage(JSON.stringify(x),w)}else{y.setSuccess()}return y.promise}function t(w){if(!w||w=="default"){return{login:function(x){a.location.href=g.createLoginUrl(x);return d().promise},logout:function(x){a.location.href=g.createLogoutUrl(x);return d().promise},accountManagement:function(){a.location.href=g.createAccountUrl();return d().promise},redirectUri:function(x){if(x&&x.redirectUri){return x.redirectUri}else{if(g.redirectUri){return g.redirectUri}else{var y=location.href;if(location.hash){y=y.substring(0,location.href.indexOf("#"));y+=(y.indexOf("?")==-1?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))}return y}}}}}if(w=="cordova"){r.enable=false;return{login:function(y){var C=d();var B="location=no";if(y&&y.prompt=="none"){B+=",hidden=yes"}var A=g.createLoginUrl(y);var z=a.open(A,"_blank",B);var D;var x;z.addEventListener("loadstart",function(E){if(E.url.indexOf("http://localhost")==0){D=f(E.url);z.close()}});z.addEventListener("loaderror",function(E){if(E.url.indexOf("http://localhost")!=0){x=true;z.close()}});z.addEventListener("exit",function(E){if(x||!D){C.setError()}else{j(D,C)}});return C.promise},logout:function(z){var B=d();var x=g.createLogoutUrl(z);var A=a.open(x,"_blank","location=no,hidden=yes");var y;A.addEventListener("loadstart",function(C){if(C.url.indexOf("http://localhost")==0){A.close()}});A.addEventListener("loaderror",function(C){if(C.url.indexOf("http://localhost")!=0){y=true;A.close()}});A.addEventListener("exit",function(C){if(y){B.setError()}else{o();B.setSuccess()}});return B.promise},accountManagement:function(){var x=g.createAccountUrl();var y=a.open(x,"_blank","location=no");y.addEventListener("loadstart",function(z){if(z.url.indexOf("http://localhost")==0){y.close()}})},redirectUri:function(x){return"http://localhost"}}}throw"invalid adapter type: "+w}};if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=b}else{a.Keycloak=b;if(typeof define==="function"&&define.amd){define("keycloak",[],function(){return b})}}})(window);